"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useChains = void 0;
const react_query_1 = require("@tanstack/react-query");
const react_1 = require("react");
const react_hook_form_1 = require("react-hook-form");
const providers_1 = require("../providers");
const stores_1 = require("../stores");
const useChains = () => {
    const { chains } = (0, providers_1.useWidgetConfig)();
    const lifi = (0, providers_1.useLiFi)();
    const { getValues, setValue } = (0, react_hook_form_1.useFormContext)();
    const initializeChains = (0, stores_1.useChainOrderStore)((state) => state.initializeChains);
    const { data, isLoading } = (0, react_query_1.useQuery)(['chains'], async () => {
        const availableChains = await lifi.getChains();
        const filteredChains = availableChains.filter((chain) => (0, providers_1.isItemAllowed)(chain.id, chains));
        const chainOrder = initializeChains(filteredChains.map((chain) => chain.id));
        const [fromChainValue, toChainValue] = getValues([
            providers_1.SwapFormKey.FromChain,
            providers_1.SwapFormKey.ToChain,
        ]);
        if (!fromChainValue) {
            setValue(providers_1.SwapFormKey.FromChain, chainOrder[0]);
        }
        if (!toChainValue) {
            setValue(providers_1.SwapFormKey.ToChain, chainOrder[0]);
        }
        return { availableChains, filteredChains };
    }, {
        refetchInterval: 180000,
        staleTime: 180000,
    });
    const getChainById = (0, react_1.useCallback)((chainId) => {
        const chain = data?.availableChains.find((chain) => chain.id === chainId);
        // if (!chain) {
        //   throw new Error('Chain not found or chainId is invalid.');
        // }
        return chain;
    }, [data]);
    return { chains: data?.filteredChains, getChainById, isLoading };
};
exports.useChains = useChains;
